openapi: 3.0.0
info:
  title: tru.ID Product APIs
  version: ""
  contact:
    name: tru.ID API Team
    email: feedback@tru.id
  description: |
    # Introduction

    The tru.ID API uses [OAuth2](/docs/reference/basics#tag/oauth2) Access Tokens for authentication. Access Tokens are created using the [/token endpoint](/docs/reference/basics#operation/oauth2-token) with a valid `client_id` and `client_secret`. `client_id` and `client_secret` credentials are obtained by [creating a Project](/docs/reference/basics#operation/post-console-v0.2-workspace-projects).

    The [**tru.ID PhoneCheck Workflow** and API](#tag/phone_check_v0.2) confirms the ownership of a mobile phone number by verifying the possession of an active SIM card with the same number. A mobile data session is created to a unique **PhoneCheck URL** for the purpose of this verification. **tru.ID** then resolves a **PhoneCheck Match** between the phone number that the mobile network operator identifies as the owner of the mobile data session and the phone number being verified.

    The [**tru.ID SubscriberCheck Workflow** and API](#tag/subscriber_check_v0.2) combines the functionality offerd by PhoneCheck and SIMCheck into a single API. It confirms the ownership of a mobile phone number and provides information on whether the SIM card associated with the mobile phone number has been changed within the last seven days.

    The [**tru.ID SIMCheck API**](#tag/sim_check_v0.1) information on whether the SIM card associated with the mobile phone number has been changed within the last seven days.

servers:
  - url: "https://{data_residency}.api.tru.id"
    description: For accounts with data residency in the EU or IN
    variables:
      data_residency:
        default: eu
        enum:
          - eu
          - in

tags:
  - name: phone_check_v0.2
    x-displayName: v0.2
    description: Relating to PhoneCheck
  - name: phone_check_v0.1
    x-displayName: v0.1
    description: Relating to PhoneCheck
  - name: subscriber_check_v0.2
    x-displayName: v0.2
    description: Relating to SubscriberCheck
  - name: subscriber_check_v0.1
    x-displayName: v0.1
    description: Relating to SubscriberCheck
  - name: sim_check_v0.1
    x-displayName: v0.1
    description: Relating to SIMCheck
  - name: oidc_flow_v0.1
    x-displayName: v0.1
    description: Relating to OIDC

x-tagGroups:
  - name: PhoneCheck
    tags:
      - phone_check_v0.2
      - phone_check_v0.1
  - name: SubscriberCheck
    tags:
      - subscriber_check_v0.2
      - subscriber_check_v0.1
  - name: SIMCheck
    tags:
      - sim_check_v0.1
  - name: OIDC
    tags:
      - oidc_flow_v0.1

paths:
  /phone_check/v0.1/checks:
    post:
      summary: Create a PhoneCheck workflow
      description: |
        Starts the PhoneCheck workflow.
      operationId: create-phone-check-v0.1
      security:
        - ProjectBearerAuth: []
      tags:
        - phone_check_v0.1
      requestBody:
        description: JSON payload to create a PhoneCheck
        content:
          application/json:
            schema:
              $ref: ./models/phone_check/PhoneCheckResourceModels.v0.1.yaml#/components/schemas/PhoneCheckCreatePayload
      callbacks:
        phoneCheckEndStatus:
          "{$request.body#/callback_url}":
            post:
              summary: PhoneCheck has reached an end status
              parameters:
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/x-tru-security
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/x-tru-callback
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/digest
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/date
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/host
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      $ref: ./models/phone_check/PhoneCheckResourceModels.v0.1.yaml#/components/schemas/PhoneCheckCallbackPayload
              responses:
                $ref: ./models/common/Responses.v1.yaml#/components/responses/WebHookExpectedResponse
      responses:
        "201":
          description: PhoneCheck created
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
          content:
            application/hal+json:
              schema:
                allOf:
                  - $ref: ./models/phone_check/PhoneCheckResourceModels.v0.1.yaml#/components/schemas/PhoneCheckCreateResponse

        "400":
          description: Bad Request
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/InvalidPhoneNumberFormat
                  - type: object
                    allOf:
                      - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/ProblemDetailsBase
                      - type: object
                        description: The country for the supplied `phone_number` is not supported
    get:
      summary: Get a collection of PhoneChecks
      operationId: get-phone-checks-v0.1
      description: Get a full list of PhoneChecks or filter by query parameter.
      security:
        - ProjectBearerAuth: []
      tags:
        - phone_check_v0.1
      parameters:
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/pageSize
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/pageNumber
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/search
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/sort
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
          content:
            application/hal+json:
              schema:
                $ref: ./models/phone_check/PhoneCheckResourceModels.v0.1.yaml#/components/schemas/PhoneCheckCollection
  "/phone_check/v0.1/checks/{check_id}":
    parameters:
      - name: check_id
        description: The ID of the PhoneCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Get PhoneCheck
      description: "Get a PhoneCheck identified by `check_id`."
      operationId: get-phone-check-v0.1
      security:
        - ProjectBearerAuth: []
      tags:
        - phone_check_v0.1
      responses:
        "200":
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: ./models/phone_check/PhoneCheckResourceModels.v0.1.yaml#/components/schemas/PhoneCheck
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
  "/phone_check/v0.1/checks/{check_id}/redirect":
    parameters:
      - name: check_id
        description: The ID of the PhoneCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Perform the PhoneCheck
      description: Perform the PhoneCheck identified by `check_id`.
      operationId: get-phone-check-redirect-v0.1
      tags:
        - phone_check_v0.1
      responses:
        "302":
          description: Redirects to the `check_url`.
          headers:
            Location:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Location
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
        "400":
          description: Mobile Network Operator Not Supported
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/MobileNetworkOperatorNotSupported
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
        "412":
          description: Not a mobile IP
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/NotMobileIp
        "501":
          description: Mobile Network Operator does not Support Redirects
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/MobileNetworkOperatorRedirectNotSupported

  "/phone_check/v0.1/checks/{check_id}/traces":
    parameters:
      - name: check_id
        description: The ID of the PhoneCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Get a collection of PhoneCheck Traces
      description: Get Traces of the PhoneCheck identified by `check_id`
      operationId: get-phone-check-traces-v0.1
      tags:
        - phone_check_v0.1
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
          content:
            application/hal+json:
              schema:
                $ref: ./models/trace/TraceResourceModels.v1.yaml#/components/schemas/TraceCollection
              examples:
                basic:
                  value:
                    _embedded:
                      traces:
                        - _links:
                            self:
                              href: "https://eu.api.tru.id/phone_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/6f2a0e25fc0caa25"
                          trace_id: 6f2a0e25fc0caa25
                          logs:
                            - timestamp: "2021-02-05T13:58:48.751Z"
                              message: "Check create: phone number is reachable"
                            - timestamp: "2021-02-05T13:58:48.856Z"
                              message: "Check balance: authorized"
                              attributes:
                                amount: 1
                                currency: API
                            - timestamp: "2021-02-05T13:58:48.864Z"
                              message: "Check create: accepted"
                        - _links:
                            self:
                              href: "https://eu.api.tru.id/phone_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/7f1bc78ab197ee8b"
                          trace_id: 7f1bc78ab197ee8b
                          logs:
                            - timestamp: "2021-02-05T13:59:05.060Z"
                              message: "Check balance: confirmed"
                              attributes:
                                amount: 1
                                currency: API
                    _links:
                      self:
                        href: "https://eu.api.tru.id/phone_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces"
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceNotFound
        "410":
          description: Trace Gone
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceGone
  "/phone_check/v0.1/checks/{check_id}/traces/{trace_id}":
    parameters:
      - name: check_id
        description: The ID of the PhoneCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
      - name: trace_id
        description: The ID of the Trace
        schema:
          type: string
        in: path
        required: true
    get:
      summary: Get PhoneCheck Trace
      description: Get the Trace identified by `trace_id` of the PhoneCheck identified by `check_id`
      operationId: get-phone-check-trace-v0.1
      tags:
        - phone_check_v0.1
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
          content:
            application/hal+json:
              schema:
                $ref: ./models/trace/TraceResourceModels.v1.yaml#/components/schemas/TraceResource
              examples:
                basic:
                  value:
                    trace_id: 6f2a0e25fc0caa25
                    logs:
                      - timestamp: "2021-02-05T13:58:48.751Z"
                        message: "Check create: request accepted"
                      - timestamp: "2021-02-05T13:58:48.824Z"
                        message: "Check create: phone number is routable"
                      - timestamp: "2021-02-05T13:58:48.856Z"
                        message: "Check balance: authorized"
                        attributes:
                          amount: 1
                          currency_code: API
                      - timestamp: "2021-02-05T13:58:48.864Z"
                        message: "Check create: successful "
                    _links:
                      self:
                        href: "https://eu.api.tru.id/phone_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/6f2a0e25fc0caa25"
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceNotFound
        "410":
          description: Trace Gone
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceGone

  /phone_check/v0.2/checks:
    post:
      summary: Create a PhoneCheck workflow
      description: |
        Starts the PhoneCheck workflow.
      operationId: create-phone-check-v0.2
      security:
        - ProjectBearerAuth: []
      tags:
        - phone_check_v0.2
      requestBody:
        description: JSON payload to create a PhoneCheck
        content:
          application/json:
            schema:
              $ref: ./models/phone_check/PhoneCheckResourceModels.v0.2.yaml#/components/schemas/PhoneCheckCreatePayload
      callbacks:
        phoneCheckEndStatus:
          "{$request.body#/callback_url}":
            post:
              summary: PhoneCheck has reached an end status
              parameters:
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/x-tru-security
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/x-tru-callback
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/digest
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/date
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/host
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      $ref: ./models/phone_check/PhoneCheckResourceModels.v0.2.yaml#/components/schemas/PhoneCheckCallbackPayload
              responses:
                $ref: ./models/common/Responses.v1.yaml#/components/responses/WebHookExpectedResponse
      responses:
        "201":
          description: PhoneCheck created
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
          content:
            application/hal+json:
              schema:
                allOf:
                  - $ref: ./models/phone_check/PhoneCheckResourceModels.v0.2.yaml#/components/schemas/PhoneCheckCreateResponse

        "400":
          description: Bad Request
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/InvalidPhoneNumberFormat
                  - type: object
                    allOf:
                      - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/ProblemDetailsBase
                      - type: object
                        description: The country for the supplied `phone_number` is not supported
    get:
      summary: Get a collection of PhoneChecks
      operationId: get-phone-checks-v0.2
      description: Get a full list of PhoneChecks or filter by query parameter.
      security:
        - ProjectBearerAuth: []
      tags:
        - phone_check_v0.2
      parameters:
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/pageSize
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/pageNumber
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/search
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/sort
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
          content:
            application/hal+json:
              schema:
                $ref: ./models/phone_check/PhoneCheckResourceModels.v0.2.yaml#/components/schemas/PhoneCheckCollection
  "/phone_check/v0.2/checks/{check_id}":
    parameters:
      - name: check_id
        description: The ID of the PhoneCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Get PhoneCheck
      description: "Get a PhoneCheck identified by `check_id`."
      operationId: get-phone-check-v0.2
      security:
        - ProjectBearerAuth: []
      tags:
        - phone_check_v0.2
      responses:
        "200":
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: ./models/phone_check/PhoneCheckResourceModels.v0.1.yaml#/components/schemas/PhoneCheck
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
    patch:
      summary: Complete PhoneCheck
      description: "Complete a PhoneCheck identified by `check_id`. NB: the device needs to visit the `check_url` to get the code which is redeemed against the PhoneCheck result before this endpoint, otherwise a 404 will be returned."
      operationId: patch-phone-check-v0.2
      security:
        - ProjectBearerAuth: []
      tags:
        - phone_check_v0.2
      requestBody:
        description: JSON payload to update a PhoneCheck
        content:
          application/json-patch+json:
            schema:
              $ref: ./models/phone_check/PhoneCheckResourceModels.v0.2.yaml#/components/schemas/PhoneCheckPatchPayload
      responses:
        "200":
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: ./models/phone_check/PhoneCheckResourceModels.v0.2.yaml#/components/schemas/PhoneCheckPatchPartial
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound

  "/phone_check/v0.2/checks/{check_id}/redirect":
    parameters:
      - name: check_id
        description: The ID of the PhoneCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Perform the PhoneCheck
      description: Perform the PhoneCheck identified by `check_id`. The device needs to perform this action over a cellular data connection.
      operationId: get-phone-check-redirect-v0.2
      tags:
        - phone_check_v0.2
      responses:
        "200":
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: ./models/phone_check/PhoneCheckResourceModels.v0.2.yaml#/components/schemas/PhoneCheck
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
        "400":
          description: Mobile Network Operator Not Supported
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/MobileNetworkOperatorNotSupported
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
        "412":
          description: Not a mobile IP
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/NotMobileIp
        "501":
          description: Mobile Network Operator does not Support Redirects
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/MobileNetworkOperatorRedirectNotSupported

  "/phone_check/v0.2/checks/{check_id}/traces":
    parameters:
      - name: check_id
        description: The ID of the PhoneCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Get a collection of PhoneCheck Traces
      description: Get Traces of the PhoneCheck identified by `check_id`
      operationId: get-phone-check-traces-v0.2
      tags:
        - phone_check_v0.2
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
          content:
            application/hal+json:
              schema:
                $ref: ./models/trace/TraceResourceModels.v1.yaml#/components/schemas/TraceCollection
              examples:
                basic:
                  value:
                    _embedded:
                      traces:
                        - _links:
                            self:
                              href: "https://eu.api.tru.id/phone_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/6f2a0e25fc0caa25"
                          trace_id: 6f2a0e25fc0caa25
                          logs:
                            - timestamp: "2021-02-05T13:58:48.751Z"
                              message: "Check create: phone number is reachable"
                            - timestamp: "2021-02-05T13:58:48.856Z"
                              message: "Check balance: authorized"
                              attributes:
                                amount: 1
                                currency: API
                            - timestamp: "2021-02-05T13:58:48.864Z"
                              message: "Check create: accepted"
                        - _links:
                            self:
                              href: "https://eu.api.tru.id/phone_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/7f1bc78ab197ee8b"
                          trace_id: 7f1bc78ab197ee8b
                          logs:
                            - timestamp: "2021-02-05T13:59:05.060Z"
                              message: "Check balance: confirmed"
                              attributes:
                                amount: 1
                                currency: API
                    _links:
                      self:
                        href: "https://eu.api.tru.id/phone_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces"
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceNotFound
        "410":
          description: Trace Gone
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceGone
  "/phone_check/v0.2/checks/{check_id}/traces/{trace_id}":
    parameters:
      - name: check_id
        description: The ID of the PhoneCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
      - name: trace_id
        description: The ID of the Trace
        schema:
          type: string
        in: path
        required: true
    get:
      summary: Get PhoneCheck Trace
      description: Get the Trace identified by `trace_id` of the PhoneCheck identified by `check_id`
      operationId: get-phone-check-trace-v0.2
      tags:
        - phone_check_v0.2
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
          content:
            application/hal+json:
              schema:
                $ref: ./models/trace/TraceResourceModels.v1.yaml#/components/schemas/TraceResource
              examples:
                basic:
                  value:
                    trace_id: 6f2a0e25fc0caa25
                    logs:
                      - timestamp: "2021-02-05T13:58:48.751Z"
                        message: "Check create: request accepted"
                      - timestamp: "2021-02-05T13:58:48.824Z"
                        message: "Check create: phone number is routable"
                      - timestamp: "2021-02-05T13:58:48.856Z"
                        message: "Check balance: authorized"
                        attributes:
                          amount: 1
                          currency_code: API
                      - timestamp: "2021-02-05T13:58:48.864Z"
                        message: "Check create: successful "
                    _links:
                      self:
                        href: "https://eu.api.tru.id/phone_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/6f2a0e25fc0caa25"
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceNotFound
        "410":
          description: Trace Gone
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceGone

  /subscriber_check/v0.2/checks:
    post:
      summary: Create an SubscriberCheck workflow
      description: |
        Starts the SubscriberCheck workflow.
      operationId: create-subscriber-check-v0.2
      security:
        - ProjectBearerAuth: []
      tags:
        - subscriber_check_v0.2
      requestBody:
        description: JSON payload to create an SubscriberCheck
        content:
          application/json:
            schema:
              $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.2.yaml#/components/schemas/SubscriberCheckCreatePayload
      callbacks:
        phoneCheckEndStatus:
          "{$request.body#/callback_url}":
            post:
              summary: SubscriberCheck has reached an end status
              parameters:
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/x-tru-security
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/x-tru-callback
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/digest
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/date
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/host
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.2.yaml#/components/schemas/SubscriberCheckCallbackPayload
              responses:
                $ref: ./models/common/Responses.v1.yaml#/components/responses/WebHookExpectedResponse
      responses:
        "201":
          description: SubscriberCheck created
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
          content:
            application/hal+json:
              schema:
                allOf:
                  - $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.2.yaml#/components/schemas/SubscriberCheckCreateResponse
        "400":
          description: Bad Request
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/InvalidPhoneNumberFormat
                  - type: object
                    allOf:
                      - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/ProblemDetailsBase
                      - type: object
                        description: The country for the supplied `phone_number` is not supported
    get:
      summary: Get a collection of SubscriberChecks
      operationId: get-subscriber-checks-v0.2
      description: Get a full list of SubscriberChecks or filter by query parameter.
      security:
        - ProjectBearerAuth: []
      tags:
        - subscriber_check_v0.2
      parameters:
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/pageSize
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/pageNumber
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/search
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/sort
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
          content:
            application/hal+json:
              schema:
                $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.2.yaml#/components/schemas/SubscriberCheckCollection
  "/subscriber_check/v0.2/checks/{check_id}":
    parameters:
      - name: check_id
        description: The ID of the SubscriberCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Get SubscriberCheck
      description: Get a SubscriberCheck identified by `check_id`.
      operationId: get-subscriber-check-v0.2
      security:
        - ProjectBearerAuth: []
      tags:
        - subscriber_check_v0.2
      responses:
        "200":
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.2.yaml#/components/schemas/SubscriberCheck
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
        "404":
          description: Check Not Found
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
    patch:
      summary: Complete SubscriberCheck
      description: "Complete a SubscriberCheck identified by `check_id`. NB: the device needs to visit the `check_url` before this endpoint, otherwise a 404 will be returned."
      operationId: patch-subscriber-check-v0.2
      security:
        - ProjectBearerAuth: []
      tags:
        - subscriber_check_v0.2
      requestBody:
        description: JSON payload to update a PhoneCheck
        content:
          application/json-patch+json:
            schema:
              $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.2.yaml#/components/schemas/SubscriberCheckPatchPayload
      responses:
        "200":
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.2.yaml#/components/schemas/SubscriberCheckPatchPartial
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound

  "/subscriber_check/v0.2/checks/{check_id}/redirect":
    parameters:
      - name: check_id
        description: The ID of the SubscriberCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Perform the SubscriberCheck
      description: Perform the SubscriberCheck identified by `check_id`. The device needs to perform this action over a cellular data connection.
      operationId: get-subscriber-check-redirect-v0.2
      tags:
        - subscriber_check_v0.2
      responses:
        "200":
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.2.yaml#/components/schemas/SubscriberCheck
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
        "400":
          description: Mobile Network Operator Not Supported
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/MobileNetworkOperatorNotSupported
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
        "412":
          description: Not a mobile IP
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/NotMobileIp
        "501":
          description: Mobile Network Operator does not Support Redirects
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/MobileNetworkOperatorRedirectNotSupported
  "/subscriber_check/v0.2/checks/{check_id}/traces":
    parameters:
      - name: check_id
        description: The ID of the SubscriberCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Get a collection of SubscriberCheck Traces
      description: Get Traces of the SubscriberCheck identified by `check_id`
      operationId: get-subscriber-check-traces-v0.2
      tags:
        - subscriber_check_v0.2
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
          content:
            application/hal+json:
              schema:
                $ref: ./models/trace/TraceResourceModels.v1.yaml#/components/schemas/TraceCollection
              examples:
                basic:
                  value:
                    _embedded:
                      traces:
                        - _links:
                            self:
                              href: "https://eu.api.tru.id/subscriber_check/v0.2/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/6f2a0e25fc0caa25"
                          trace_id: 6f2a0e25fc0caa25
                          logs:
                            - timestamp: "2021-02-05T13:58:48.751Z"
                              message: "Check create: phone number is reachable"
                            - timestamp: "2021-02-05T13:58:48.856Z"
                              message: "Check balance: authorized"
                              attributes:
                                amount: 1
                                currency: API
                            - timestamp: "2021-02-05T13:58:48.864Z"
                              message: "Check create: accepted"
                        - _links:
                            self:
                              href: "https://eu.api.tru.id/subscriber_check/v0.2/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/7f1bc78ab197ee8b"
                          trace_id: 7f1bc78ab197ee8b
                          logs:
                            - timestamp: "2021-02-05T13:59:05.060Z"
                              message: "Check balance: confirmed"
                              attributes:
                                amount: 1
                                currency: API
                    _links:
                      self:
                        href: "https://eu.api.tru.id/subscriber_check/v0.2/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces"
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceNotFound
        "410":
          description: Trace Gone
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceGone
  "/subscriber_check/v0.2/checks/{check_id}/traces/{trace_id}":
    parameters:
      - name: check_id
        description: The ID of the SubscriberCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
      - name: trace_id
        description: The ID of the of the Trace
        schema:
          type: string
        in: path
        required: true
    get:
      summary: Get SubscriberCheck Trace
      description: Get the Trace identified by `trace_id`  of the SubscriberCheck identified by `check_id`
      operationId: get-subscriber-check-trace-v0.2
      tags:
        - subscriber_check_v0.2
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
          content:
            application/hal+json:
              schema:
                $ref: ./models/trace/TraceResourceModels.v1.yaml#/components/schemas/TraceResource
              examples:
                basic:
                  value:
                    trace_id: 6f2a0e25fc0caa25
                    logs:
                      - timestamp: "2021-02-05T13:58:48.751Z"
                        message: "Check create: phone number is reachable"
                      - timestamp: "2021-02-05T13:58:48.856Z"
                        message: "Check balance: authorized"
                        attributes:
                          amount: 1
                          currency: API
                      - timestamp: "2021-02-05T13:58:48.864Z"
                        message: "Check create: accepted"
                        _links:
                          self:
                            href: "https://eu.api.tru.id/subscriber_check/v0.2/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/6f2a0e25fc0caa25"
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceNotFound
        "410":
          description: Trace Gone
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceGone

  /subscriber_check/v0.1/checks:
    post:
      summary: Create an SubscriberCheck workflow
      description: |
        Starts the SubscriberCheck workflow.
      operationId: create-subscriber-check
      security:
        - ProjectBearerAuth: []
      tags:
        - subscriber_check_v0.1
      requestBody:
        description: JSON payload to create an SubscriberCheck
        content:
          application/json:
            schema:
              $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.1.yaml#/components/schemas/SubscriberCheckCreatePayload
      callbacks:
        phoneCheckEndStatus:
          "{$request.body#/callback_url}":
            post:
              summary: SubscriberCheck has reached an end status
              parameters:
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/x-tru-security
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/x-tru-callback
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/digest
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/date
                - $ref: ./models/common/Headers.v1.yaml#/components/headers/host
              requestBody:
                required: true
                content:
                  application/json:
                    schema:
                      $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.1.yaml#/components/schemas/SubscriberCheckCallbackPayload
              responses:
                $ref: ./models/common/Responses.v1.yaml#/components/responses/WebHookExpectedResponse
      responses:
        "201":
          description: SubscriberCheck created
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
          content:
            application/hal+json:
              schema:
                allOf:
                  - $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.1.yaml#/components/schemas/SubscriberCheckCreateResponse
        "400":
          description: Bad Request
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/InvalidPhoneNumberFormat
                  - type: object
                    allOf:
                      - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/ProblemDetailsBase
                      - type: object
                        description: The country for the supplied `phone_number` is not supported
    get:
      summary: Get a collection of SubscriberChecks
      operationId: get-subscriber-checks
      description: Get a full list of SubscriberChecks or filter by query parameter.
      security:
        - ProjectBearerAuth: []
      tags:
        - subscriber_check_v0.1
      parameters:
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/pageSize
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/pageNumber
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/search
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/sort
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
          content:
            application/hal+json:
              schema:
                $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.1.yaml#/components/schemas/SubscriberCheckCollection
  "/subscriber_check/v0.1/checks/{check_id}":
    parameters:
      - name: check_id
        description: The ID of the SubscriberCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Get SubscriberCheck
      description: Get a SubscriberCheck identified by `check_id`.
      operationId: get-subscriber-check
      security:
        - ProjectBearerAuth: []
      tags:
        - subscriber_check_v0.1
      responses:
        "200":
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: ./models/subscriber_check/SubscriberCheckResourceModels.v0.1.yaml#/components/schemas/SubscriberCheck
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
  "/subscriber_check/v0.1/checks/{check_id}/redirect":
    parameters:
      - name: check_id
        description: The ID of the SubscriberCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Perform the SubscriberCheck
      description: Perform the SubscriberCheck identified by `check_id`.
      operationId: get-subscriber-check-redirect
      tags:
        - subscriber_check_v0.1
      responses:
        "302":
          description: Redirects to the `check_url`.
          headers:
            Location:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Location
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
        "400":
          description: Mobile Network Operator Not Supported
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/MobileNetworkOperatorNotSupported
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
        "412":
          description: Not a mobile IP
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/NotMobileIp
        "501":
          description: Mobile Network Operator does not Support Redirects
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/MobileNetworkOperatorRedirectNotSupported
  "/subscriber_check/v0.1/checks/{check_id}/traces":
    parameters:
      - name: check_id
        description: The ID of the SubscriberCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Get a collection of SubscriberCheck Traces
      description: Get Traces of the SubscriberCheck identified by `check_id`
      operationId: get-subscriber-check-traces
      tags:
        - subscriber_check_v0.1
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
          content:
            application/hal+json:
              schema:
                $ref: ./models/trace/TraceResourceModels.v1.yaml#/components/schemas/TraceCollection
              examples:
                basic:
                  value:
                    _embedded:
                      traces:
                        - _links:
                            self:
                              href: "https://eu.api.tru.id/subscriber_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/6f2a0e25fc0caa25"
                          trace_id: 6f2a0e25fc0caa25
                          logs:
                            - timestamp: "2021-02-05T13:58:48.751Z"
                              message: "Check create: phone number is reachable"
                            - timestamp: "2021-02-05T13:58:48.856Z"
                              message: "Check balance: authorized"
                              attributes:
                                amount: 1
                                currency: API
                            - timestamp: "2021-02-05T13:58:48.864Z"
                              message: "Check create: accepted"
                        - _links:
                            self:
                              href: "https://eu.api.tru.id/subscriber_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/7f1bc78ab197ee8b"
                          trace_id: 7f1bc78ab197ee8b
                          logs:
                            - timestamp: "2021-02-05T13:59:05.060Z"
                              message: "Check balance: confirmed"
                              attributes:
                                amount: 1
                                currency: API
                    _links:
                      self:
                        href: "https://eu.api.tru.id/subscriber_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces"
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceNotFound
        "410":
          description: Trace Gone
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceGone
  "/subscriber_check/v0.1/checks/{check_id}/traces/{trace_id}":
    parameters:
      - name: check_id
        description: The ID of the SubscriberCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
      - name: trace_id
        description: The ID of the of the Trace
        schema:
          type: string
        in: path
        required: true
    get:
      summary: Get SubscriberCheck Trace
      description: Get the Trace identified by `trace_id`  of the SubscriberCheck identified by `check_id`
      operationId: get-subscriber-check-trace
      tags:
        - subscriber_check_v0.1
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
          content:
            application/hal+json:
              schema:
                $ref: ./models/trace/TraceResourceModels.v1.yaml#/components/schemas/TraceResource
              examples:
                basic:
                  value:
                    trace_id: 6f2a0e25fc0caa25
                    logs:
                      - timestamp: "2021-02-05T13:58:48.751Z"
                        message: "Check create: phone number is reachable"
                      - timestamp: "2021-02-05T13:58:48.856Z"
                        message: "Check balance: authorized"
                        attributes:
                          amount: 1
                          currency: API
                      - timestamp: "2021-02-05T13:58:48.864Z"
                        message: "Check create: accepted"
                        _links:
                          self:
                            href: "https://eu.api.tru.id/subscriber_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/6f2a0e25fc0caa25"
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceNotFound
        "410":
          description: Trace Gone
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceGone

  /sim_check/v0.1/checks:
    post:
      summary: Create a SIMCheck
      description: |
        Starts the SIMCheck
      operationId: create-sim-check
      security:
        - ProjectBearerAuth: []
      tags:
        - sim_check_v0.1
      requestBody:
        description: JSON payload to create a SIMCheck
        content:
          application/json:
            schema:
              $ref: ./models/sim_check/SimCheckResourceModels.v1.yaml#/components/schemas/SimCheckCreatePayload
      responses:
        "201":
          description: SIMCheck created
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
          content:
            application/hal+json:
              schema:
                allOf:
                  - $ref: ./models/sim_check/SimCheckResourceModels.v1.yaml#/components/schemas/SimCheck
                  - type: object
                    properties:
                      status:
                        description: The current status of the SIMCheck
                        type: string
                        enum:
                          - COMPLETED
                          - ERROR
                        example: COMPLETED
                      snapshot_balance:
                        description: |
                          The workspace balance in `charge_currency` taking into account the `charge_amount`.
                          This property is not persisted and is only returned when the SIMCheck is initially created.
                        type: number
                        example: 100
        "400":
          description: Mobile Network Operator Not Supported
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/MobileNetworkOperatorNotSupported
        "412":
          description: Not a mobile IP
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/NotMobileIp
    get:
      summary: Get a collection of SIMChecks
      operationId: get-sim-checks
      description: Get a full list of SIMChecks or filter by query parameter.
      security:
        - ProjectBearerAuth: []
      tags:
        - sim_check_v0.1
      parameters:
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/pageSize
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/pageNumber
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/search
        - $ref: ./models/common/PageBasedPagination.v1.yaml#/components/parameters/sort
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
          content:
            application/hal+json:
              schema:
                $ref: ./models/sim_check/SimCheckResourceModels.v1.yaml#/components/schemas/SimCheckCollection
  "/sim_check/v0.1/checks/{check_id}":
    parameters:
      - name: check_id
        description: The ID of the SIMCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Get SIMCheck
      description: Get a SIMCheck identified by `check_id`.
      operationId: get-sim-check
      security:
        - ProjectBearerAuth: []
      tags:
        - sim_check_v0.1
      responses:
        "200":
          description: OK
          content:
            application/hal+json:
              schema:
                $ref: ./models/sim_check/SimCheckResourceModels.v1.yaml#/components/schemas/SimCheck
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
  "/sim_check/v0.1/checks/{check_id}/traces":
    parameters:
      - name: check_id
        description: The ID of the SIMCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    get:
      summary: Get a collection of SIMCheck Traces
      description: Get Traces of the SIMCheck identified by `check_id`
      operationId: get-sim-check-traces
      tags:
        - sim_check_v0.1
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
          content:
            application/hal+json:
              schema:
                $ref: ./models/trace/TraceResourceModels.v1.yaml#/components/schemas/TraceCollection
              examples:
                basic:
                  value:
                    _embedded:
                      traces:
                        - _links:
                            self:
                              href: "https://eu.api.tru.id/sim_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/6f2a0e25fc0caa25"
                          trace_id: 6f2a0e25fc0caa25
                          logs:
                            - timestamp: "2021-02-05T13:58:48.751Z"
                              message: "Check create: phone number is reachable"
                            - timestamp: "2021-02-05T13:58:48.856Z"
                              message: "Check balance: authorized"
                              attributes:
                                amount: 1
                                currency: API
                            - timestamp: "2021-02-05T13:58:48.864Z"
                              message: "Check create: accepted"
                        - _links:
                            self:
                              href: "https://eu.api.tru.id/sim_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/7f1bc78ab197ee8b"
                          trace_id: 7f1bc78ab197ee8b
                          logs:
                            - timestamp: "2021-02-05T13:59:05.060Z"
                              message: "Check balance: confirmed"
                              attributes:
                                amount: 1
                                currency: API
                    _links:
                      self:
                        href: "https://eu.api.tru.id/sim_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces"
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceNotFound
        "410":
          description: Trace Gone
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceGone
  "/sim_check/v0.1/checks/{check_id}/traces/{trace_id}":
    parameters:
      - name: check_id
        description: The ID of the SIMCheck
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
      - name: trace_id
        description: The ID of the of the trace
        schema:
          type: string
        in: path
        required: true
    get:
      summary: Get Simcheck Trace
      description: Get the Trace identified by `trace_id`  of the SIMCheck identified by `check_id`
      operationId: get-sim-check-trace
      tags:
        - sim_check_v0.1
      responses:
        "200":
          description: OK
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
            Access-Control-Allow-Origin:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/Access-Control-Allow-Origin-All
          content:
            application/hal+json:
              schema:
                $ref: ./models/trace/TraceResourceModels.v1.yaml#/components/schemas/TraceResource
              examples:
                basic:
                  value:
                    trace_id: 6f2a0e25fc0caa25
                    logs:
                      - timestamp: "2021-02-05T13:58:48.751Z"
                        message: "Check create: request accepted"
                      - timestamp: "2021-02-05T13:58:48.824Z"
                        message: "Check create: phone number is routable"
                      - timestamp: "2021-02-05T13:58:48.856Z"
                        message: "Check balance: authorized"
                        attributes:
                          amount: 1
                          currency_code: API
                      - timestamp: "2021-02-05T13:58:48.864Z"
                        message: "Check create: successful"
                    _links:
                      self:
                        href: "https://eu.api.tru.id/sim_check/v0.1/checks/857b1bab-c2e8-41ec-9f76-9695ec78b91b/traces/6f2a0e25fc0caa25"
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                oneOf:
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/CheckNotFound
                  - $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceNotFound
        "410":
          description: Trace Gone
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/TraceGone

  "/oidc/v0.1/flows/{flow_id}":
    parameters:
      - name: flow_id
        description: The ID of the OIDC flow
        schema:
          $ref: ./models/common/DataTypes.v1.yaml#/components/schemas/UUID
        in: path
        required: true
    patch:
      summary: Terminate OIDC flow
      description: "Lets the client terminate the OIDC flow."
      operationId: patch-oidc-flow-v0.1
      security:
        - ProjectBearerAuth: []
      tags:
        - oidc_flow_v0.1
      requestBody:
        description: JSON payload to update a PhoneCheck
        content:
          application/json-patch+json:
            schema:
              oneOf:
                - $ref: ./models/oidc/OIDCFlowResourceModels.v1.yaml#/components/schemas/OIDCPatchPayload
                - $ref: ./models/oidc/OIDCFlowResourceModels.v1.yaml#/components/schemas/OIDCPatchFailurePayload
      responses:
        "200":
          description: OK
          content:
            application/hal+json:
              schema:
                oneOf:
                  - $ref: ./models/oidc/OIDCFlowResourceModels.v1.yaml#/components/schemas/OIDCPatchResponse
                  - $ref: ./models/oidc/OIDCFlowResourceModels.v1.yaml#/components/schemas/OIDCPatchFailureResponse
          headers:
            X-RateLimit-Limit:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Limit
            X-RateLimit-Remaining:
              $ref: ./models/common/Headers.v1.yaml#/components/headers/X-RateLimit-Remaining
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: ./models/common/HTTPProblemDetailTypes.v1.yaml#/components/responses/FlowNotFound
components:
  securitySchemes:
    ProjectBearerAuth:
      description: |
        The tru.ID APIs expect the bearer token to be a [OAuth2 Access Token](https://tools.ietf.org/html/rfc6749#section-1.4). The access token should be within the `Authorization` HTTP header.
        e.g. `Authorization: Bearer {access_token}`. See [Create an Access Token](#operation/oauth2-token).

        The token should be associated with **tru.ID** Project. These are created using a Project `client_id` and `client_secret`. See [Create an Access Token](#operation/oauth2-token).
      type: http
      scheme: bearer
